<!-- templates/results.html -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <!-- jQuery + DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <p><a href="{{ url_for('form') }}">í¼ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a> | <a href="{{ url_for('index') }}">ê´€ë¦¬ì ì—…ë¡œë“œ</a></p>
    <h1 style="text-align:center;">ì „ì²´ ì‘ë‹µ ë³´ê¸°</h1>

    <div class="container">
        <a href="{{ url_for('export_csv') }}"><button>CSVë¡œ ë‚´ë³´ë‚´ê¸°</button></a>
    </div>

    {% for group in grouped_responses %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Timestamp</th> <!-- Move this line up -->
                    {% for col in group.columns %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for r in group.responses %}
                <tr>
                    <td>{{ r.id }}</td>
                    <td>{{ r.timestamp }}</td>
                    {% for col in group.columns %}
                        {% set answer = r.answers.get(col, '-') %}
                        {% if answer != '-' and answer.lower().endswith(('.png', '.jpg', '.jpeg', '.gif', '.bmp')) %}
                            <td><a href="{{ url_for('uploaded_file', filename=answer) }}" target="_blank">{{ answer }}</a></td>
                        {% else %}
                            <td>{{ answer }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <br><br>
    {% endfor %}

    <script>
        $(document).ready(function () {
            $('.data-table').DataTable({
                paging: true,
                pageLength: 10,
                lengthChange: false,
                ordering: true,
                info: true,
                autoWidth: false,
                language: {
                    search: "ğŸ” ê²€ìƒ‰:",
                    zeroRecords: "ì¼ì¹˜í•˜ëŠ” í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤",
                    info: "ì´ _TOTAL_ê°œ ì¤‘ _START_ ~ _END_ í•­ëª© í‘œì‹œ",
                    infoEmpty: "ë°ì´í„° ì—†ìŒ",
                    infoFiltered: "(ì „ì²´ _MAX_ í•­ëª© ì¤‘ í•„í„°ë§ë¨)",
                    paginate: {
                        first: "ì²˜ìŒ",
                        last: "ë§ˆì§€ë§‰",
                        next: "ë‹¤ìŒ",
                        previous: "ì´ì „"
                    }
                }
            });
        });
    </script>
</body>
</html>
